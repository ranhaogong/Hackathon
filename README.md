### README · 喷它！3D 减压互动舞台

#### 项目简介

这是一个用 **Three.js + Web 技术** 实现的 3D 减压小玩具：  
你可以对人物 **扔鸡蛋 / 扔西红柿 / 用语音喷 / 冲马桶 / 改木板标语 / 文本聊天 + 大模型回复**，人物会跳舞、挨打、吐槽、被冲走，非常解压。

---

### 主要功能一览

#### 1. 3D 人物 & 舞台

- 使用 `assets/model.glb` 作为人物模型，加载后自动：
  - **落地居中**（脚踩在地面上）
  - 适配高度缩放到合适比例
- 无GLB动作用 **程序化骨骼动画** 实现：
  - **持续跳舞**（身体左右摆、头部点头、手臂随节奏摆动）
  - **受击动作**：被打时身体和手臂有抖动/扭动

- 舞台地面：
  - 使用 `CircleGeometry` + CanvasTexture 生成 **暖色地面纹理**（颗粒、划痕、暗角）
  - 看起来更像一个卡通舞台的地板

---

### 2. 胸前木板标语

- 左侧有一个 **📝 名称按钮**，点击后弹出输入弹窗：
  - 在弹窗中输入文字（最多 20 字）
  - 点击确定后，人物胸前的 **木板标语**更新为你的文字
- 木板实现细节：
  - 木板尺寸自动根据模型体型估算（`boardW/boardH`）
  - 贴图用 Canvas 绘制：
    - 木纹背景 + 深色边框
    - 字体自动缩放，最多 2 行，始终居中
  - Canvas 宽高比例会动态匹配木板几何比例，**防止文字被压扁**  

---

### 3. 语音“喷他”功能

- 右侧有一个 **🎤 语音球按钮**：
  - **桌面 / 支持 Web Speech 浏览器**：
    - 点击开始录音，按钮有呼吸动画
    - 上方出现“**请说话…**”的录音提示气泡
    - 识别到中文语音后，提示气泡中的文字实时变成识别结果
    - 再次点击停止录音：
      - 在语音球旁生成一条文本气泡
      - 文本气泡从语音球飞向人物脸部，**砸脸+抖动+碎裂**
      - 同时把识别到的文字发给大模型，拿到一句短回复气泡弹出
  - **移动端 / 不支持 Web Speech（例如 iOS Safari）**：
    - 会尝试用 `MediaRecorder` 录音并显示“请说话…”
    - 停止后弹出一个输入弹窗，让用户手动输入要喷的话
    - 仍然走同样的“砸脸动画 + 大模型回复气泡”

---

### 4. 文本聊天 + 大模型回复

- 底部有一个 **聊天输入栏**（桌面和手机都显示）：
  - 输入一句话 → 点击“发送”
  - 这句话会：
    1. 以气泡形式从聊天栏飞向人物脸部，**砸脸**（力度略轻于鸡蛋）
    2. 同时将文本发给后端大模型接口（从 `Node.js` 提取的 prompt 逻辑）
       - 模型扮演“贱萌受气包”
       - 根据受击次数自动切换状态：healthy / hurt / dying
       - 只返回 **极短、贱萌口语化台词（≤15字）**
    3. 模型的回复以 **AI 气泡** 出现在人物脸旁

- 即使大模型调用失败：
  - 会自动使用多条预设兜底文案，例如：
    - “我听见了。先深呼吸一下。”
    - “可以的，你继续说。”
    - “别急，我在。”

---

### 5. 扔鸡蛋 & 扔西红柿

- 舞台左下有两个按钮：
  - **🥚 鸡蛋**：
    - 鸟蛋椭球模型 + 米白色蛋壳纹理
    - 随机瞄准人物 **头 / 胸 / 肚子 / 腿** 不同高度
    - 飞行轨迹是带弧度的抛物线
    - 击中人物后：
      - 鸡蛋提前停在人物表面，避免穿模
      - 蛋壳变为蛋黄贴图
      - 在人物身上生成蛋液贴图 Sprite（会随时间滴落、扩散、淡出）
      - 触发受击抖动动画 + 随机吐槽气泡
  - **🍅 西红柿**：
    - 椭球红色西红柿模型 + 纹理
    - 瞄准逻辑和鸡蛋类似
    - 击中人物后：
      - 西红柿停在表面，**停留 1 秒** 后消失
      - 在人物身上生成**红色西红柿汁液**贴图（也会滴落/淡出）

---

### 6. 冲马桶（处决技）

- 底部有一个 **🚽 冲走他** 按钮：
  - 点击后：
    - 播放本地音效 `assets/toilet-bowl-flush.mp3`（失败则回退到合成白噪音冲水声）
    - 人物原地加速绕 **Z 轴旋转**，然后被**脚底的漩涡吸走**
    - 舞台上出现蓝色水流粒子 + 漩涡特效（Canvas 纹理 + 3D 粒子）
    - 人物会暂时消失 3 秒，期间从天而降一个大号卡通口号（随机），例如：
      - “冲走了，压力也走了。”
      - “呼——这一波，算你赢。”
    - 大字口号会在人物消失期间保持 3 秒，并始终渲染在最前面

- 冲走结束：
  - 清理所有蛋液/西红柿汁液/水流粒子
  - 人物重新出现并继续跳舞
  - 大模型端的受击次数 `hitCount` 被重置，状态回到“嚣张”模式

---

### 7. 受击回复 & 背景气泡

- 每次被鸡蛋 / 西红柿 / 语音 / 文本砸中时：
  - 人物会随机弹出一条 **“受击回复气泡”**，例如：
    - “错了错了！”
    - “别打了！”
    - “嘴下留情！”
  - 气泡在人物脸附近生成，上升 + 淡入/淡出后消失

- 背景还有两条大号台词气泡（固定在人物后面，避免穿模）：
  - “压力山大！受够了！”
  - “我要发泄！”

---

### 8. 视觉与交互细节

- 灯光：
  - 环境光 + 半球光 + 聚光 + 补光，**特意把人物提亮一点**
- 背景：
  - 使用多层渐变 + **放射状条块** 背景，并在 `body::before` 上做 **超慢旋转** 动画（80s 转一圈）
- 点击人物（PC + 移动端）：
  - 直接点击 3D 人物也会触发一次受击动作 + 吐槽气泡
- 所有文字气泡（语音预览、语音砸脸、聊天、口号等）统一用 CanvasTexture 生成，带圆角对白框、阴影和动态缩放/浮动动画。

---

### 使用方式（开发）

- 入口文件：
  - `index.html`：页面结构 + 按钮布局 + 模态框
  - `main.js`：Three.js 场景、动画、交互逻辑、音效和大模型调用
  - `style.css`：整体 UI & 移动端适配样式
- 直接用浏览器打开 `index.html` 即可预览（推荐 Chrome/Edge）




![48a6454a774e73852a943e4f69b2a286](https://github.com/user-attachments/assets/4f5750ee-3050-4ffc-959c-51c24d6f3668)


